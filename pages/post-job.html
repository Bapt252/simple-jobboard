<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publier une offre d'emploi - Nexten</title>
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="../components/header.js"></script>
    <script src="../components/footer.js"></script>
    <!-- API Google Maps avec paramètre de chargement asynchrone et gestionnaire d'erreur -->
    <script>
        function handleGoogleMapsError() {
            console.error("Erreur de chargement de l'API Google Maps");
            // Ajouter un message d'erreur visible à l'utilisateur
            setTimeout(() => {
                const addressFields = document.querySelectorAll('#company-address');
                addressFields.forEach(field => {
                    if (field && field.parentNode) {
                        const errorMsg = document.createElement('div');
                        errorMsg.className = 'error-message';
                        errorMsg.style.color = '#ef4444';
                        errorMsg.style.fontSize = '0.85rem';
                        errorMsg.style.marginTop = '5px';
                        errorMsg.innerHTML = '<i class="fas fa-exclamation-triangle"></i> L\'autocomplétion d\'adresses est indisponible. Saisissez l\'adresse manuellement.';
                        
                        // Vérifier si un message d'erreur existe déjà
                        if (!field.parentNode.querySelector('.error-message')) {
                            field.parentNode.appendChild(errorMsg);
                        }
                    }
                });
            }, 2000);
        }

        function initAutocompleteCallback() {
            // Fonction appelée quand Google Maps est correctement chargé
            console.log("Google Maps API chargée avec succès");
            try {
                initAutocomplete(); // Fonction définie dans le script principal
            } catch (e) {
                console.error("Erreur lors de l'initialisation de l'autocomplete", e);
                handleGoogleMapsError();
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpOvIETyTmlNODPoMEZ46l1ogsQg7Fcyg&libraries=places&callback=initAutocompleteCallback" async defer onerror="handleGoogleMapsError()"></script>
</head>
<body>
    <header></header>

    <section class="post-job">
        <div class="container">
            <div style="text-align: center; margin-bottom: 2rem;">
                <span class="badge badge-ai">
                    <i class="fas fa-robot"></i> Propulsé par l'IA
                </span>
                <h2 style="margin-bottom: 0.5rem;">Publiez votre offre d'emploi</h2>
                <p style="color: var(--text); font-size: 1.1rem; max-width: 800px; margin: 0 auto;">Notre intelligence artificielle analysera votre offre et vous proposera les 10 meilleurs candidats correspondant à votre besoin.</p>
            </div>

            <div class="card fade-in">
                <h3 class="card-title">Avez-vous actuellement un poste à pourvoir ?</h3>
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                    <div class="card" id="option-yes" style="flex: 1; min-width: 250px; cursor: pointer; padding: 1.5rem; transition: all 0.3s ease; background-color: var(--light); border-left-color: transparent;">
                        <div style="font-size: 2rem; color: var(--primary); margin-bottom: 1rem;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4 style="font-size: 1.2rem; font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Oui</h4>
                        <p style="color: var(--text); font-size: 0.95rem; line-height: 1.5;">Je souhaite publier une offre d'emploi et trouver des candidats correspondant à mon besoin.</p>
                    </div>
                    <div class="card" id="option-no" style="flex: 1; min-width: 250px; cursor: pointer; padding: 1.5rem; transition: all 0.3s ease; background-color: var(--light); border-left-color: transparent;">
                        <div style="font-size: 2rem; color: var(--primary); margin-bottom: 1rem;">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <h4 style="font-size: 1.2rem; font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Non</h4>
                        <p style="color: var(--text); font-size: 0.95rem; line-height: 1.5;">Je souhaite seulement explorer les profils disponibles ou me tenir informé.</p>
                    </div>
                </div>
            </div>

            <!-- Formulaire court pour recruteurs sans poste ouvert -->
            <div class="form-card" id="short-form" style="display: none; animation: fadeIn 0.5s ease;">
                <h3 class="form-title">Dites-nous en plus sur votre entreprise</h3>
                <div style="margin-bottom: 1.5rem;">
                    <p>Nous avons besoin de quelques informations sur votre entreprise pour vous proposer les profils qui correspondent le mieux à votre secteur d'activité.</p>
                </div>
                
                <form id="company-info-form">
                    <div class="form-group">
                        <label for="company-name" style="display: block; margin-bottom: 0.7rem; font-weight: 500; color: var(--dark); position: relative;">
                            Nom de la structure <span style="color: var(--primary);">*</span>
                        </label>
                        <input type="text" id="company-name" placeholder="Ex: TechSolutions" required style="width: 100%; padding: 0.9rem; border: 1px solid #e2e8f0; border-radius: var(--radius); font-size: 1rem; transition: var(--transition); background-color: var(--light);">
                    </div>
                    
                    <div class="form-group">
                        <label for="company-address" style="display: block; margin-bottom: 0.7rem; font-weight: 500; color: var(--dark); position: relative;">
                            Adresse complète <span style="color: var(--primary);">*</span>
                        </label>
                        <div style="position: relative;">
                            <input type="text" id="company-address" placeholder="Ex: 123 Avenue des Champs-Élysées, 75008 Paris" required style="width: 100%; padding: 0.9rem; border: 1px solid #e2e8f0; border-radius: var(--radius); font-size: 1rem; transition: var(--transition); background-color: var(--light);">
                        </div>
                        <small style="color: var(--primary); font-size: 0.85rem; margin-top: 0.3rem; display: block;">Commencez à saisir votre adresse pour voir des suggestions</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="company-website" style="display: block; margin-bottom: 0.7rem; font-weight: 500; color: var(--dark); position: relative;">
                            Site internet
                        </label>
                        <input type="url" id="company-website" placeholder="Ex: https://www.example.com" style="width: 100%; padding: 0.9rem; border: 1px solid #e2e8f0; border-radius: var(--radius); font-size: 1rem; transition: var(--transition); background-color: var(--light);">
                    </div>
                    
                    <div class="form-group">
                        <label for="company-description" style="display: block; margin-bottom: 0.7rem; font-weight: 500; color: var(--dark); position: relative;">
                            Présentation rapide <span style="color: var(--primary);">*</span>
                        </label>
                        <textarea id="company-description" rows="5" placeholder="Décrivez brièvement votre entreprise, son activité et sa mission..." required style="width: 100%; padding: 0.9rem; border: 1px solid #e2e8f0; border-radius: var(--radius); font-size: 1rem; transition: var(--transition); background-color: var(--light);"></textarea>
                        <span class="badge badge-ai" id="generate-description" style="margin-top: 0.5rem; cursor: pointer; display: inline-flex;">
                            <i class="fas fa-magic"></i> Générer une description
                        </span>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                        Enregistrer et continuer <i class="fas fa-arrow-right" style="margin-left: 0.8rem;"></i>
                    </button>
                </form>
            </div>
            
            <div class="progress-steps" id="progress-steps" style="display: none;">
                <div class="step active">
                    <div class="step-circle">1</div>
                    <div class="step-text">Informations recruteur</div>
                </div>
                <div class="step">
                    <div class="step-circle">2</div>
                    <div class="step-text">Questionnaire détaillé</div>
                </div>
                <div class="step">
                    <div class="step-circle">3</div>
                    <div class="step-text">Candidats recommandés</div>
                </div>
            </div>
            
            <div class="card fade-in" id="parsing-info" style="display: none; margin-bottom: 2rem;">
                <h3 class="card-title" style="color: var(--primary); display: flex; align-items: center;">
                    <i class="fas fa-magic" style="margin-right: 0.5rem;"></i> Comment notre IA analyse votre offre
                </h3>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
                    <div style="background-color: var(--light); padding: 1rem; border-radius: var(--radius); flex: 1; min-width: 200px;">
                        <div>
                            <span style="display: inline-block; background-color: var(--primary); color: white; width: 24px; height: 24px; border-radius: 50%; text-align: center; line-height: 24px; font-weight: 500; margin-right: 0.5rem;">1</span>
                            <span style="font-weight: 500; color: var(--dark); margin-bottom: 0.5rem;">Extraction</span>
                        </div>
                        <p style="font-size: 0.9rem; color: var(--text);">Notre algorithme extrait automatiquement les compétences requises, l'expérience et les mots-clés importants.</p>
                    </div>
                    <div style="background-color: var(--light); padding: 1rem; border-radius: var(--radius); flex: 1; min-width: 200px;">
                        <div>
                            <span style="display: inline-block; background-color: var(--primary); color: white; width: 24px; height: 24px; border-radius: 50%; text-align: center; line-height: 24px; font-weight: 500; margin-right: 0.5rem;">2</span>
                            <span style="font-weight: 500; color: var(--dark); margin-bottom: 0.5rem;">Analyse</span>
                        </div>
                        <p style="font-size: 0.9rem; color: var(--text);">L'IA identifie les aspects essentiels du poste et comprend les compétences transférables.</p>
                    </div>
                    <div style="background-color: var(--light); padding: 1rem; border-radius: var(--radius); flex: 1; min-width: 200px;">
                        <div>
                            <span style="display: inline-block; background-color: var(--primary); color: white; width: 24px; height: 24px; border-radius: 50%; text-align: center; line-height: 24px; font-weight: 500; margin-right: 0.5rem;">3</span>
                            <span style="font-weight: 500; color: var(--dark); margin-bottom: 0.5rem;">Matching</span>
                        </div>
                        <p style="font-size: 0.9rem; color: var(--text);">Nous recherchons dans notre base de données les profils qui correspondent le mieux à votre besoin.</p>
                    </div>
                </div>
            </div>
            
            <div class="card fade-in" id="questionnaire-card" style="display: none; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                    <div style="width: 60px; height: 60px; background-color: rgba(108, 99, 255, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1.5rem; font-size: 1.8rem; color: var(--primary);">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div>
                        <h3 class="card-title" style="margin-bottom: 0.3rem;">Questionnaire recruteur amélioré</h3>
                        <p style="color: var(--text); font-size: 1rem;">Un processus optimisé pour un matching plus précis</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <p>Notre questionnaire recruteur vous permet de préciser tous les aspects importants de votre recherche pour un matching optimal avec les candidats. Le processus est simple et intuitif :</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: flex-start;">
                        <i class="fas fa-building" style="color: var(--primary); margin-right: 0.8rem; margin-top: 0.3rem;"></i>
                        <div style="font-size: 0.95rem; color: var(--text);">
                            Informations sur votre entreprise et culture
                        </div>
                    </div>
                    <div style="display: flex; align-items: flex-start;">
                        <i class="fas fa-file-upload" style="color: var(--primary); margin-right: 0.8rem; margin-top: 0.3rem;"></i>
                        <div style="font-size: 0.95rem; color: var(--text);">
                            Upload de fiche de poste avec analyse IA
                        </div>
                    </div>
                    <div style="display: flex; align-items: flex-start;">
                        <i class="fas fa-users" style="color: var(--primary); margin-right: 0.8rem; margin-top: 0.3rem;"></i>
                        <div style="font-size: 0.95rem; color: var(--text);">
                            Précisions sur l'environnement de travail
                        </div>
                    </div>
                    <div style="display: flex; align-items: flex-start;">
                        <i class="fas fa-search" style="color: var(--primary); margin-right: 0.8rem; margin-top: 0.3rem;"></i>
                        <div style="font-size: 0.95rem; color: var(--text);">
                            Critères de recrutement spécifiques
                        </div>
                    </div>
                </div>
                
                <a href="recruiter-questionnaire-matching.html" class="btn btn-primary btn-lg" id="startQuestionnaireBtn">
                    Commencer le questionnaire <i class="fas fa-arrow-right" style="margin-left: 0.8rem;"></i>
                </a>
                
                <script>
                    // Rediriger vers la page du questionnaire recruteur en matching learning
                    document.getElementById('startQuestionnaireBtn').addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Sauvegarder l'état du questionnaire pour savoir que c'est le flux de matching learning
                        localStorage.setItem('recruiterFlow', 'matching');
                        
                        // Redirection temporisée pour simuler le traitement
                        setTimeout(() => {
                            window.location.href = 'recruiter-questionnaire-matching.html';
                        }, 1000);
                    });
                </script>
                
                <script>
                    // Fonction pour collecter et sauvegarder les données de l'entreprise
                    function saveCompanyData() {
                        // Initialiser les données de l'entreprise dans localStorage pour le questionnaire
                        const companyAddressInput = document.getElementById('company-address');
                        const companyName = document.getElementById('company-name')?.value || '';
                        const companyAddress = companyAddressInput?.value || '';
                        const companyWebsite = document.getElementById('company-website')?.value || '';
                        const companyDescription = document.getElementById('company-description')?.value || '';
                        
                        // Récupérer les données de géolocalisation si disponibles
                        const formattedAddress = companyAddressInput?.dataset?.formattedAddress || companyAddress;
                        const lat = companyAddressInput?.dataset?.lat || null;
                        const lng = companyAddressInput?.dataset?.lng || null;
                        
                        // Création des données de l'entreprise avec géolocalisation
                        const companyData = {
                            name: companyName,
                            address: companyAddress,
                            formattedAddress: formattedAddress,
                            location: lat && lng ? { lat: parseFloat(lat), lng: parseFloat(lng) } : null,
                            website: companyWebsite, 
                            description: companyDescription,
                            dataFromPostJob: true
                        };
                        
                        // Sauvegarde des données dans localStorage
                        localStorage.setItem('recruiterCompanyData', JSON.stringify(companyData));
                        console.log('Données de l\'entreprise sauvegardées:', companyData);
                        
                        return companyData;
                    }
                    
                    // Associer les boutons aux actions de sauvegarde
                    document.getElementById('startQuestionnaireBtn').addEventListener('click', function(e) {
                        saveCompanyData();
                    });
                    
                    // Ajouter un écouteur d'événement pour le bouton de matching learning
                    document.querySelector('a[href="recruiter-questionnaire-matching.html"]').addEventListener('click', function(e) {
                        saveCompanyData();
                    });
                </script>
            </div>
        </div>
    </section>

    <footer></footer>

    <script>
        // Fonction pour initialiser l'autocomplete Google Maps Places
        function initAutocomplete() {
            // Autocomplete pour l'adresse de l'entreprise
            const addressInput = document.getElementById('company-address');
            if (addressInput) {
                try {
                    // Vérifier si l'API Google Maps est chargée
                    if (typeof google === 'undefined' || typeof google.maps === 'undefined' || typeof google.maps.places === 'undefined') {
                        console.error("L'API Google Maps n'a pas été chargée correctement");
                        handleGoogleMapsError();
                        return;
                    }
                    
                    const autocomplete = new google.maps.places.Autocomplete(addressInput, {
                        types: ['address'],
                        componentRestrictions: { country: ['fr'] },  // Limiter aux adresses françaises
                        fields: ['address_components', 'formatted_address', 'geometry', 'name']
                    });
                    
                    // Indiquer visuellement que l'autocomplétion est disponible
                    addressInput.placeholder = "Commencez à saisir l'adresse...";
                    addressInput.parentNode.querySelector('label').innerHTML += ' <span style="color: var(--success); font-size: 0.8rem;">(autocomplétion activée)</span>';
                    
                    // Ajouter un indicateur de chargement à l'input
                    const parentDiv = addressInput.parentNode;
                    let loadingElement = parentDiv.querySelector('.loading-indicator');
                    if (!loadingElement) {
                        loadingElement = document.createElement('div');
                        loadingElement.className = 'loading-indicator';
                        loadingElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        loadingElement.style.position = 'absolute';
                        loadingElement.style.right = '10px';
                        loadingElement.style.top = '50%';
                        loadingElement.style.transform = 'translateY(-50%)';
                        loadingElement.style.color = 'var(--primary)';
                        loadingElement.style.display = 'none';
                        
                        // Si le parent n'a pas de position relative, la définir
                        if (window.getComputedStyle(parentDiv).position === 'static') {
                            parentDiv.style.position = 'relative';
                        }
                        
                        parentDiv.appendChild(loadingElement);
                    }
                    
                    // Afficher l'indicateur de chargement lors de la saisie
                    addressInput.addEventListener('input', function() {
                        if (this.value.length > 3) {
                            loadingElement.style.display = 'block';
                        } else {
                            loadingElement.style.display = 'none';
                        }
                    });
                    
                    // Enregistrer l'adresse complète lorsqu'un lieu est sélectionné
                    autocomplete.addListener('place_changed', function() {
                        // Masquer l'indicateur de chargement
                        loadingElement.style.display = 'none';
                        
                        const place = autocomplete.getPlace();
                        if (!place || !place.geometry) {
                            // L'utilisateur a appuyé sur entrée sans sélectionner de suggestion
                            console.warn("Adresse saisie mais non sélectionnée dans les suggestions");
                            addressInput.style.borderColor = "#f97316"; // Orange pour avertissement
                            return;
                        }
                        
                        // Sauvegarder les coordonnées et l'adresse formatée pour une utilisation ultérieure
                        const formattedAddress = place.formatted_address || addressInput.value;
                        const lat = place.geometry.location.lat();
                        const lng = place.geometry.location.lng();
                        
                        // Mettre à jour l'input avec l'adresse formatée
                        addressInput.value = formattedAddress;
                        
                        // Stocker les données de géolocalisation dans des attributs de données
                        addressInput.dataset.formattedAddress = formattedAddress;
                        addressInput.dataset.lat = lat;
                        addressInput.dataset.lng = lng;
                        
                        // Confirmation visuelle subtile pour l'utilisateur
                        addressInput.style.borderColor = "#10b981";
                        
                        // Ajouter une icône de confirmation dans l'input
                        const existingIcon = parentDiv.querySelector('.address-validated');
                        if (!existingIcon) {
                            const confirmIcon = document.createElement('div');
                            confirmIcon.className = 'address-validated';
                            confirmIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #10b981;"></i>';
                            confirmIcon.style.position = 'absolute';
                            confirmIcon.style.right = '10px';
                            confirmIcon.style.top = '50%';
                            confirmIcon.style.transform = 'translateY(-50%)';
                            parentDiv.appendChild(confirmIcon);
                        }
                        
                        // Créer un message de confirmation qui s'auto-efface
                        const confirmDiv = document.createElement('div');
                        confirmDiv.className = 'address-confirm';
                        confirmDiv.innerHTML = `<i class="fas fa-check-circle"></i> Adresse validée: ${formattedAddress}`;
                        confirmDiv.style.color = "#10b981";
                        confirmDiv.style.fontSize = "0.85rem";
                        confirmDiv.style.marginTop = "5px";
                        
                        // Ajouter le message après l'input
                        const existingConfirm = parentDiv.querySelector('.address-confirm');
                        if (existingConfirm) {
                            existingConfirm.remove();
                        }
                        parentDiv.appendChild(confirmDiv);
                        
                        console.log('Adresse sélectionnée:', formattedAddress);
                        console.log('Coordonnées:', lat, lng);
                        
                        // Auto-effacement après 5 secondes
                        setTimeout(() => {
                            confirmDiv.style.opacity = '0';
                            confirmDiv.style.transition = 'opacity 0.5s ease';
                            setTimeout(() => {
                                if (confirmDiv.parentNode) {
                                    confirmDiv.remove();
                                }
                            }, 500);
                        }, 5000);
                    });
                } catch (error) {
                    console.error("Erreur lors de l'initialisation de l'autocomplete Google Maps:", error);
                    handleGoogleMapsError();
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const optionYes = document.getElementById('option-yes');
            const optionNo = document.getElementById('option-no');
            const shortForm = document.getElementById('short-form');
            const progressSteps = document.getElementById('progress-steps');
            const steps = document.querySelectorAll('.step');
            const parsingInfo = document.getElementById('parsing-info');
            const questionnaireCard = document.getElementById('questionnaire-card');
            const companyInfoForm = document.getElementById('company-info-form');
            const generateDescriptionBtn = document.getElementById('generate-description');
            const companyWebsiteInput = document.getElementById('company-website');
            const companyDescriptionInput = document.getElementById('company-description');
            
            // Fonction pour styliser les options
            function styleSelectedOption(selected, unselected) {
                selected.style.borderColor = 'var(--primary)';
                selected.style.borderLeftColor = 'var(--primary)';
                selected.style.backgroundColor = 'rgba(108, 99, 255, 0.05)';
                selected.style.transform = 'translateY(-5px)';
                selected.style.boxShadow = 'var(--shadow-lg)';
                
                unselected.style.borderColor = 'transparent';
                unselected.style.backgroundColor = 'var(--light)';
                unselected.style.transform = 'none';
                unselected.style.boxShadow = 'var(--shadow-md)';
            }
            
            // Vérifier la présence de tous les éléments du DOM
            if (!optionYes || !optionNo || !shortForm || !progressSteps || !parsingInfo || !questionnaireCard) {
                console.error("Certains éléments du DOM sont manquants pour initialiser la page");
                return;
            }
            
            // Option Oui
            optionYes.addEventListener('click', function() {
                // Animer l'option sélectionnée
                styleSelectedOption(this, optionNo);
                
                // Masquer le formulaire court s'il est visible
                if (shortForm) {
                    shortForm.style.display = 'none';
                }
                
                // Afficher le reste du contenu avec animation
                setTimeout(() => {
                    progressSteps.style.display = 'flex';
                    parsingInfo.style.display = 'block';
                    questionnaireCard.style.display = 'block';
                    
                    // Animer l'apparition
                    [progressSteps, parsingInfo, questionnaireCard].forEach(el => {
                        if (el) {
                            el.style.opacity = '0';
                            el.style.transform = 'translateY(20px)';
                        }
                    });
                    
                    setTimeout(() => {
                        [progressSteps, parsingInfo, questionnaireCard].forEach(el => {
                            if (el) {
                                el.style.opacity = '1';
                                el.style.transform = 'translateY(0)';
                                el.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                            }
                        });
                    }, 50);
                    
                    // Scroll vers la section stepper avec animation plus fluide
                    if (progressSteps) {
                        progressSteps.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    }
                }, 300);
            });
            
            // Option Non
            optionNo.addEventListener('click', function() {
                // Animer l'option sélectionnée
                styleSelectedOption(this, optionYes);
                
                // Masquer les sections de recrutement
                if (progressSteps) progressSteps.style.display = 'none';
                if (parsingInfo) parsingInfo.style.display = 'none';
                if (questionnaireCard) questionnaireCard.style.display = 'none';
                
                // Afficher le formulaire court avec animation
                if (shortForm) {
                    shortForm.style.display = 'block';
                    shortForm.style.opacity = '0';
                    shortForm.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        shortForm.style.opacity = '1';
                        shortForm.style.transform = 'translateY(0)';
                        shortForm.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        shortForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 50);
                }
            });
            
            // Validation du formulaire en temps réel
            if (companyInfoForm) {
                // Ajouter validation à tous les champs requis
                const requiredInputs = companyInfoForm.querySelectorAll('input[required], textarea[required]');
                requiredInputs.forEach(input => {
                    input.addEventListener('blur', function() {
                        validateField(this);
                    });
                    
                    input.addEventListener('input', function() {
                        if (this.value.trim() !== '') {
                            validateField(this);
                        }
                    });
                });
                
                function validateField(field) {
                    // Supprimer les messages d'erreur existants
                    const existingError = field.parentNode.querySelector('.error-message');
                    if (existingError) existingError.remove();
                    
                    // Valider le champ
                    if (field.required && field.value.trim() === '') {
                        field.style.borderColor = '#ef4444';
                        const errorMsg = document.createElement('div');
                        errorMsg.className = 'error-message';
                        errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> Ce champ est obligatoire';
                        field.parentNode.appendChild(errorMsg);
                        return false;
                    } else if (field.type === 'email' && field.value.trim() !== '') {
                        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailPattern.test(field.value)) {
                            field.style.borderColor = '#ef4444';
                            const errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> Email invalide';
                            field.parentNode.appendChild(errorMsg);
                            return false;
                        }
                    } else if (field.type === 'url' && field.value.trim() !== '') {
                        try {
                            new URL(field.value);
                            field.style.borderColor = '#10b981';
                        } catch (e) {
                            field.style.borderColor = '#ef4444';
                            const errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> URL invalide';
                            field.parentNode.appendChild(errorMsg);
                            return false;
                        }
                    }
                    
                    // Si tout est valide
                    field.style.borderColor = field.value.trim() ? '#10b981' : '#e2e8f0';
                    return true;
                }
                
                // Traitement du formulaire court
                companyInfoForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Vérifier la validité de tous les champs
                    let formValid = true;
                    requiredInputs.forEach(input => {
                        if (!validateField(input)) {
                            formValid = false;
                        }
                    });
                    
                    if (!formValid) {
                        const firstInvalid = companyInfoForm.querySelector('input[style*="border-color: rgb(239, 68, 68)"], textarea[style*="border-color: rgb(239, 68, 68)"]');
                        if (firstInvalid) {
                            firstInvalid.focus();
                            firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        return;
                    }
                    
                    // Animer le bouton de soumission
                    const submitButton = this.querySelector('.btn-primary');
                    const originalText = submitButton.innerHTML;
                    submitButton.innerHTML = '<span class="loading-spinner"></span> Traitement en cours...';
                    submitButton.disabled = true;
                    
                    // Simuler un délai de traitement
                    setTimeout(() => {
                        // Créer une notification de succès
                        const successNotif = document.createElement('div');
                        successNotif.className = 'success-notification';
                        successNotif.innerHTML = `
                            <div style="background-color: #10b981; color: white; padding: 15px 20px; border-radius: var(--radius); box-shadow: var(--shadow-lg); position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; max-width: 400px; transform: translateY(100px); opacity: 0; transition: all 0.5s ease;">
                                <i class="fas fa-check-circle" style="font-size: 1.5rem; margin-right: 10px;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 5px;">Informations enregistrées</div>
                                    <div style="font-size: 0.9rem;">Vous allez être redirigé vers l'espace recruteur.</div>
                                </div>
                            </div>
                        `;
                        document.body.appendChild(successNotif);
                        
                        // Animer l'apparition de la notification
                        setTimeout(() => {
                            const notif = successNotif.querySelector('div');
                            if (notif) {
                                notif.style.transform = 'translateY(0)';
                                notif.style.opacity = '1';
                            }
                        }, 100);
                        
                        // Indiquer que l'utilisateur vient du parcours sans poste
                        localStorage.setItem('recruiterFlow', 'noJob');
                        
                        // Rediriger vers le tableau de bord recruteur après un délai
                        setTimeout(() => {
                            window.location.href = 'recruiter-dashboard.html';
                        }, 2000);
                    }, 1500);
                });
            }
            
            // Génération de description d'entreprise basée sur le site web
            if (generateDescriptionBtn && companyWebsiteInput && companyDescriptionInput) {
                generateDescriptionBtn.addEventListener('click', function() {
                    const website = companyWebsiteInput.value.trim();
                    if (!website) {
                        // Feedback visuel au lieu d'une alerte
                        companyWebsiteInput.style.borderColor = '#ef4444';
                        companyWebsiteInput.focus();
                        
                        // Ajouter message d'erreur s'il n'existe pas déjà
                        const existingError = companyWebsiteInput.parentNode.querySelector('.error-message');
                        if (!existingError) {
                            const errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> Veuillez entrer une URL de site web';
                            companyWebsiteInput.parentNode.appendChild(errorMsg);
                        }
                        return;
                    }
                    
                    // Valider le format URL
                    try {
                        new URL(website);
                    } catch (e) {
                        // Feedback visuel pour URL invalide
                        companyWebsiteInput.style.borderColor = '#ef4444';
                        companyWebsiteInput.focus();
                        
                        // Ajouter message d'erreur
                        const existingError = companyWebsiteInput.parentNode.querySelector('.error-message');
                        if (!existingError) {
                            const errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> Format d\'URL invalide (ex: https://example.com)';
                            companyWebsiteInput.parentNode.appendChild(errorMsg);
                        }
                        return;
                    }
                    
                    // Supprimer les messages d'erreur existants
                    const existingError = companyWebsiteInput.parentNode.querySelector('.error-message');
                    if (existingError) existingError.remove();
                    
                    // Marquer l'URL comme valide
                    companyWebsiteInput.style.borderColor = '#10b981';
                    
                    // Simuler un chargement
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Génération avec IA en cours...';
                    this.style.pointerEvents = 'none';
                    
                    // Extraire le domaine pour la recherche
                    const domain = website.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0];
                    
                    // Définir les étapes de traitement pour un effet plus réaliste
                    const processingSteps = [
                        'Analyse du site web...',
                        'Collecte des informations...',
                        'Traitement par IA...',
                        'Finalisation du contenu...'
                    ];
                    
                    let currentStep = 0;
                    
                    // Simuler les étapes de traitement
                    const processingInterval = setInterval(() => {
                        if (currentStep < processingSteps.length) {
                            this.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${processingSteps[currentStep]}`;
                            currentStep++;
                        } else {
                            clearInterval(processingInterval);
                            
                            // Générer la description finale
                            let description;
                            
                            // Définir des descriptions préconfigurées pour certains domaines connus
                            if (domain === 'google.com') {
                                description = "Google est une entreprise technologique mondiale qui développe des produits et services liés à Internet, notamment des technologies de recherche, de cloud computing, de logiciels et de matériel. Fondée en 1998 par Larry Page et Sergey Brin, Google a pour mission d'organiser l'information à l'échelle mondiale et de la rendre universellement accessible et utile.";
                            } else if (domain === 'microsoft.com') {
                                description = "Microsoft est une entreprise technologique multinationale qui développe, fabrique, licencie et vend des logiciels informatiques, des produits électroniques, des ordinateurs et des services personnels. Fondée en 1975 par Bill Gates et Paul Allen, Microsoft s'est donné pour mission d'aider chaque personne et chaque organisation sur la planète à accomplir davantage.";
                            } else if (domain === 'apple.com') {
                                description = "Apple est une entreprise technologique américaine qui conçoit, développe et vend des produits électroniques grand public, des logiciels informatiques et des services en ligne. Fondée en 1976 par Steve Jobs, Steve Wozniak et Ronald Wayne, Apple est connue pour ses produits innovants comme l'iPhone, l'iPad, le Mac et l'Apple Watch.";
                            } else if (domain.includes('example.com')) {
                                description = "TechSolutions est une entreprise innovante spécialisée dans le développement de solutions logicielles pour les entreprises. Fondée en 2015, elle compte aujourd'hui plus de 50 collaborateurs passionnés par la technologie et l'innovation. Avec une approche centrée sur le client, TechSolutions s'efforce de fournir des solutions sur mesure qui répondent parfaitement aux besoins spécifiques de chaque client.";
                            } else {
                                // Générer une description dynamique pour les autres domaines
                                const companyName = domain.split('.')[0].charAt(0).toUpperCase() + domain.split('.')[0].slice(1);
                                const randomYear = 2010 + Math.floor(Math.random() * 10);
                                const sectors = ["technologique", "de services", "de conseil", "spécialisée en informatique", "innovante"];
                                const sector = sectors[Math.floor(Math.random() * sectors.length)];
                                
                                description = `${companyName} est une entreprise ${sector} dynamique qui se distingue par son approche innovante et sa vision stratégique. Fondée en ${randomYear}, l'entreprise a développé une expertise reconnue dans son domaine et continue d'élargir son offre pour répondre aux besoins évolutifs du marché. Sa culture d'entreprise valorise la collaboration, la créativité et l'excellence. Avec une vision orientée vers l'avenir, ${companyName} s'engage à fournir des produits et services de qualité supérieure tout en maintenant une forte responsabilité envers ses clients, ses employés et la société.`;
                            }
                            
                            // Simuler une saisie progressive pour un effet plus naturel
                            let i = 0;
                            companyDescriptionInput.value = '';
                            
                            const typingEffect = setInterval(() => {
                                if (i < description.length) {
                                    companyDescriptionInput.value += description.charAt(i);
                                    i++;
                                    
                                    // Faire défiler pour voir le texte en cours de saisie
                                    companyDescriptionInput.scrollTop = companyDescriptionInput.scrollHeight;
                                } else {
                                    clearInterval(typingEffect);
                                    
                                    // Afficher un message de succès et prévenir toute surcharge visuelle
                                    this.innerHTML = '<i class="fas fa-check-circle"></i> Description générée avec IA';
                                    this.style.backgroundColor = "#10b981";
                                    this.style.color = "white";
                                    
                                    // Style de validation pour le champ description
                                    companyDescriptionInput.style.borderColor = '#10b981';
                                    
                                    // Restaurer le bouton après un délai
                                    setTimeout(() => {
                                        this.innerHTML = '<i class="fas fa-magic"></i> Générer une description';
                                        this.style.backgroundColor = "";
                                        this.style.color = "";
                                        this.style.pointerEvents = 'auto';
                                    }, 3000);
                                }
                            }, 5);
                        }
                    }, 800);
                });
            }
            
            // Animer les étapes au chargement pour effet visuel
            if (steps && steps.length > 0) {
                steps.forEach((step, index) => {
                    step.style.opacity = '0';
                    step.style.transform = 'translateY(10px)';
                    step.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    
                    setTimeout(() => {
                        step.style.opacity = '1';
                        step.style.transform = 'translateY(0)';
                    }, 100 * index);
                });
            }
        });
    </script>
</body>
</html>
